{
  "kind": "build_request",
  "title": "Continue MetalHead Underground development",
  "projectName": "MetalHead Underground",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Implement a fallback mechanism in the frontend to automatically retry failed requests using alternative ICP gateway URLs (raw.icp0.io) when the primary gateway returns 'Canister ID not resolved' errors",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-15"
        ]
      },
      "acceptanceCriteria": [
        "When a canister request fails with gateway resolution errors, the system automatically retries using the raw.icp0.io gateway",
        "Users see a loading state during retry attempts",
        "Failed requests are logged for debugging",
        "Successful retry displays content without requiring manual URL changes"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add a network status indicator in the app header that detects and displays gateway connectivity issues, with a manual retry button",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-15"
        ]
      },
      "acceptanceCriteria": [
        "Status indicator shows green when gateway is responding normally",
        "Status indicator shows yellow/warning when using fallback gateway",
        "Status indicator shows red when gateway requests are failing",
        "Manual retry button allows users to force a connection attempt",
        "Indicator is visible but unobtrusive in the app layout"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Implement client-side DNS cache clearing mechanism that suggests browser cache clearing steps when persistent gateway errors are detected",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-12",
          "msg-13"
        ]
      },
      "acceptanceCriteria": [
        "After 3 consecutive gateway failures, show a helpful modal with cache clearing instructions",
        "Instructions are device-specific (Android tablet, phone, desktop)",
        "Modal includes options to try alternative gateway or switch networks",
        "Users can dismiss the modal and continue attempting",
        "Modal does not appear more than once per session"
      ]
    }
  ],
  "constraints": [
    "Must maintain single-actor backend architecture",
    "Cannot modify immutable frontend paths: useInternetIdentity.ts, useInternetIdentity.tsx, useActor.ts, main.tsx, components/ui/*",
    "Must work within ICP's gateway infrastructure without requiring external services",
    "Gateway fallback logic must not break existing authentication flow"
  ],
  "nonGoals": [
    "Fixing the underlying ICP gateway infrastructure issues",
    "Implementing custom DNS resolution or proxy servers",
    "Adding third-party monitoring or analytics services",
    "Modifying backend canister code for gateway issues",
    "Creating alternative hosting outside ICP ecosystem"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}